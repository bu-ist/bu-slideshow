jQuery(document).ready(function(c){function f(a,b,e){"undefined"===typeof e&&(e=!1);c(".error").remove();a='<div class="error"><p>'+a+"</p></div>";e?b.prepend(a):b.append(a);setTimeout(function(){c(".error").fadeOut(500)},1E3)}var h=c("#bu-slideshow-newform"),s=c("#bu-slideshow-manage"),k=c("#bu-slideshow-slides"),l=c("#bu-slideshow-edit");if(h.length)h.on("submit",function(){return c("#bu-new-slideshow-name").val().length?!0:(f("You must enter a name.",h),!1)});s.length&&k.length&&function(a){var b= {};b.container=k;b.list=c(a.list);if(!b.list.length)throw TypeError("Invalid element supplied to slideshow manager.");b.nonce=c("#bu_slideshow_nonce").val();b.numShows=function(){return b.list.find("li").length};b.addEmptyMsg=function(){b.getUrl("add_url",function(a){b.list.append("<li><p>"+buSlideshowLocalAdmin.noSlideshowsMsg+'</p><p><a class="button" href="'+a+'">'+buSlideshowLocalAdmin.addButtonText+"</a></p></li>")})};b.getUrl=function(a,b){c.post(ajaxurl,{action:"bu_slideshow_get_url",url:a}, function(a){b(a)})};b.list.on("click",".bu-slideshow-delete",function(){if(confirm(buSlideshowLocalAdmin.deleteConfirm)){var a=c(this),d;d={action:"bu_delete_slideshow",id:a.attr("data-slideshow-id"),bu_slideshow_nonce:b.nonce};c.post(ajaxurl,d,function(c){b.deleteResponse(a,c)})}return!1});b.deleteResponse=function(a,c){if(c&&"0"!==c)a.parent().parent("li").remove(),b.container.find(".error").remove(),b.numShows()||b.addEmptyMsg();else return f(buSlideshowLocalAdmin.deleteError,b.container),!1}}({list:"#bu-slideshow-manage"}); if(c("#bu_slideshow_modal_button").length&&"function"===typeof BuModal&&"function"===typeof SlideshowSelector){var m=new BuModal({el:"#bu_slideshow_modal_wrap"}),g=new SlideshowSelector("#bu_slideshow_modal_wrap .bu-slideshow-selector");c("#bu_slideshow_modal_button").on("click",function(){m.open()});c("#bu_slideshow_modal_wrap").on("click","#bu_insert_slideshow",function(a){g.ui.parent().find(".error").remove();a=g.getOptions();if(!parseInt(a.show_id))return f(buSlideshowLocalAdmin.noneSelectedError, g.ui.parent()),!1;window.send_to_editor("<br />"+('[bu_slideshow show_id="'+a.show_id+'" show_nav="'+a.show_nav+'" transition="'+a.transition+'" nav_style="'+a.nav_style+'" autoplay="'+a.autoplay+'" width="'+a.width+'"]')+"<br />");g.reset();m.close();return!1})}if(l.length){var n,p;n=0.9*c(window).height();var q=function(a,b){c("#bu-slideshow-editform-submit").prop("disabled","disabled");window.reindexingSlides=!0;var e=/bu_slides\[([0-9]*)\](.*)/,d="";c(".bu-slideshow-slide").each(function(a,b){c(b).find("input, textarea").each(function(b, f){var g=c(f);d=g.attr("name");d=d.replace(e,"bu_slides["+a+"]$2");g.attr("name",d)})});c("#bu-slideshow-editform-submit").prop("disabled",!1);window.reindexingSlides=!1},t=function(a){c.post(ajaxurl,{action:"bu_add_slide",order:a},function(a){a?(a=c(a),a.appendTo("#bu-slideshow-slidelist ul"),r(a.find(".bu-slideshow-add-img")),c("#bu-slideshow-slidelist ul li:last-child .bu-slide-edit-container").slideDown()):f(buSlideshowLocalAdmin.addSlideFailError,c("#bu-slideshow-slidelist"))})},r=function(a){p= a.attr("href")+"&width=640&height="+n;a.attr("href",p)};c(".bu-slide-edit-container").hide();c("#bu-slideshow-slidelist").on("click",".bu-slide-expand",function(){var a=c(this),b;b=a.parents(".bu-slideshow-slide").find(".bu-slide-edit-container");a.hasClass("open")?(a.removeClass("open"),b.slideUp(300)):(a.addClass("open"),b.slideDown(300));return!1});c("#bu-slideshow-slidelist").on("keyup",".bu-slideshow-title-input",function(){var a=c(this);a.parents(".bu-slideshow-slide").find(".bu-slide-title").text(a.val())}); c("#bu-slideshow-editform").on("submit",function(){return c("#bu_slideshow_name").val().replace(" ","")?!window.reindexingSlides:(f(buSlideshowLocalAdmin.emptyNameError,c(this)),!1)});c("#bu-slideshow-slidelist ul").sortable({stop:q,placeholder:"sortable-placeholder",start:function(a,b){var e=b.item.height(),d=b.item.width();c(".sortable-placeholder").outerHeight(e).width(d)}});c("#bu-slideshow-add-slide").on("click",function(){var a=l.find("#bu-slideshow-slidelist li").length;t(a);return!1});c("#bu-slideshow-slidelist").on("click", ".bu-slide-delete-button",function(){confirm(buSlideshowLocalAdmin.deleteConfirmSlide)&&(c(this).parents().parent(".bu-slideshow-slide").remove(),q());return!1});window.buUploaders={newEditor:window.wp&&window.wp.media?!0:!1,init:function(a){a=c(a);if(!a.length)throw new TypeError("No valid button identified.");this.slide=a.parents(".bu-slideshow-slide");this.populateFields()},populateFields:function(){this.addButton=this.slide.find(".bu-slideshow-add-img");this.removeButton=this.slide.find(".bu-slideshow-remove-img"); this.imgIdField=this.slide.find(".bu-slideshow-img-id");this.imgSizeField=this.slide.find(".bu-slideshow-img-size");this.thumbContainers=this.slide.find(".bu-slide-thumb, .bu-slide-header-thumb")},select:function(){this.newEditor?this.newHandleImageSelect():this.oldHandleImageSelect()},remove:function(){this.thumbContainers.each(function(a,b){c(b).find("img").remove()});this.imgIdField.val("");this.imgSizeField.val("");this.removeButton.hide()},oldHandleImageSelect:function(){var a=this;window.send_to_editor= function(b){var e,d;c("body").append("<div id='slideshow_image_added' style='display:none;'>"+b+"</div>");e=c("#slideshow_image_added").find("img").attr("class");d=/wp-image-([0-9]*)/i;(d=d.exec(e))?(b=d[1],d=/size-([a-zA-Z]*)/i,d=d.exec(e),e=d[1],d?(a.setImageDetails(b,e),b={action:"bu_get_slide_thumb",image_id:b},c.post(ajaxurl,b,function(b){a.handleImgThumbResponse(b)}),c("#slideshow_image_added").remove(),tb_remove()):(tb_remove(),f(buSlideshowLocalAdmin.imageFail,a.slide.find(".bu-slide-edit-container"), !0))):(tb_remove(),f(buSlideshowLocalAdmin.imageFail,a.slide.find(".bu-slide-edit-container"),!0))}},handleImgThumbResponse:function(a){var b,e;(a=c.parseJSON(a))&&"0"!==a?(this.thumbContainers.each(function(d,f){e=c(f);b=e.find("img");b.length?b.attr("src",a[0]):e.append('<img src="'+a[0]+'" alt="'+buSlideshowLocalAdmin.thumbAltText+'" />')}),this.removeButton.show()):f(buSlideshowLocalAdmin.thumbFailError,this.slide.find(".bu-slide-edit-container"),!0)},newHandleImageSelect:function(){var a=this; if("object"!==typeof buUploadFrame){var b=wp.media.view.MediaFrame.Select.prototype.browseContent;a.modifyWPSelectFrame();buUploadFrame=wp.media.frames.bu_slideshow_frame=wp.media({multiple:!1,title:buSlideshowLocalAdmin.mediaUploadTitle,button:{text:buSlideshowLocalAdmin.mediaUploadButton},library:{type:"image"}});wp.media.view.MediaFrame.Select.prototype.browseContent=b;buUploadFrame.on("select",function(){var b,c;c=buUploadFrame.state();b=c.get("selection").first();c=c.display(b).attributes;b= b.toJSON().id;a.getImgThumb(b);a.setImageDetails(b,c.size)})}buUploadFrame.open()},modifyWPSelectFrame:function(){wp.media.view.MediaFrame.Select.prototype.browseContent=function(a){var b=this.state(),c=b.get("selection");this.$el.removeClass("hide-toolbar");a.view=new wp.media.view.AttachmentsBrowser({controller:this,collection:b.get("library"),model:b,sortable:b.get("sortable"),search:b.get("searchable"),filters:b.get("filterable"),display:!0,dragInfo:b.get("dragInfo"),selection:c,sortable:!0,search:!1, dragInfo:!0,AttachmentView:wp.media.view.Attachment.EditLibrary})}},getImgThumb:function(a){var b=this;c.post(ajaxurl,{action:"bu_get_slide_thumb",image_id:a},function(a){b.handleImgThumbResponse(a)})},setImageDetails:function(a,b){this.imgIdField.val(a);this.imgSizeField.val(b)}};c("#bu-slideshow-slidelist").on("click",".bu-slideshow-add-img",function(a){window.buUploaders.init(this);window.buUploaders.select();return!1});c("#bu-slideshow-slidelist").on("click",".bu-slideshow-remove-img",function(){window.buUploaders.init(this); window.buUploaders.remove();return!1});c("#bu-slideshow-slidelist .bu-slideshow-add-img").each(function(){r(c(this))})}c("#bu_slideshow_show_nav").on("click",function(){c(".bu_slideshow_nav_style").toggle()})});