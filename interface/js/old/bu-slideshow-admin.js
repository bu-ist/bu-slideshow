jQuery(document).ready(function(b){function f(a,c,e){"undefined"===typeof e&&(e=!1);b(".error").remove();a='<div class="error"><p>'+a+"</p></div>";e?c.prepend(a):c.append(a);setTimeout(function(){b(".error").fadeOut(500)},5E3)}var h=b("#bu-slideshow-newform"),s=b("#bu-slideshow-manage"),k=b("#bu-slideshow-slides"),l=b("#bu-slideshow-edit");h.length&&h.submit(function(){return b("#bu-new-slideshow-name").val().length?!0:(f("You must enter a name.",h),!1)});s.length&&k.length&&function(a){var c={}; c.container=k;c.list=b(a.list);if(!c.list.length)throw TypeError("Invalid element supplied to slideshow manager.");c.nonce=b("#bu_slideshow_nonce").val();c.numShows=function(){return c.list.find("li").length};c.addEmptyMsg=function(){c.getUrl("add_url",function(a){c.list.append("<li><p>"+buSlideshowLocalAdmin.noSlideshowsMsg+'</p><p><a class="button" href="'+a+'">'+buSlideshowLocalAdmin.addButtonText+"</a></p></li>")})};c.getUrl=function(a,c){b.post(ajaxurl,{action:"bu_slideshow_get_url",url:a},function(a){c(a)})}; c.list.find(".bu-slideshow-delete").live("click",function(){if(confirm(buSlideshowLocalAdmin.deleteConfirm)){var a=b(this),d;d={action:"bu_delete_slideshow",id:a.attr("data-slideshow-id"),bu_slideshow_nonce:c.nonce};b.post(ajaxurl,d,function(b){c.deleteResponse(a,b)})}return!1});c.deleteResponse=function(a,b){if(b&&"0"!==b)a.parent().parent("li").remove(),c.container.find(".error").remove(),c.numShows()||c.addEmptyMsg();else return f(buSlideshowLocalAdmin.deleteError,c.container),!1}}({list:"#bu-slideshow-manage"}); if(b("#bu_slideshow_modal_button").length&&"function"===typeof BuModal&&"function"===typeof SlideshowSelector){var m=new BuModal({el:"#bu_slideshow_modal_wrap"}),g=new SlideshowSelector("#bu_slideshow_modal_wrap .bu-slideshow-selector");b("#bu_slideshow_modal_button").click(function(){m.open()});b("#bu_insert_slideshow").live("click",function(a){g.ui.parent().find(".error").remove();a=g.getOptions();if(!parseInt(a.show_id))return f(buSlideshowLocalAdmin.noneSelectedError,g.ui.parent()),!1;window.send_to_editor("<br />"+ ('[bu_slideshow show_id="'+a.show_id+'" show_nav="'+a.show_nav+'" transition="'+a.transition+'" nav_style="'+a.nav_style+'" autoplay="'+a.autoplay+'" width="'+a.width+'"]')+"<br />");g.reset();m.close();return!1})}if(l.length){var n,p;n=0.9*b(window).height();var q=function(a,c){b("#bu-slideshow-editform-submit").attr("disabled","disabled");window.reindexingSlides=!0;var e=/bu_slides\[([0-9]*)\](.*)/,d="";b(".bu-slideshow-slide").each(function(a,c){b(c).find("input, textarea").each(function(c,f){var g= b(f);d=g.attr("name");d=d.replace(e,"bu_slides["+a+"]$2");g.attr("name",d)})});b("#bu-slideshow-editform-submit").removeAttr("disabled");window.reindexingSlides=!1},t=function(a){b.post(ajaxurl,{action:"bu_add_slide",order:a},function(a){a?(a=b(a),a.appendTo("#bu-slideshow-slidelist ul"),r(a.find(".bu-slideshow-add-img")),b("#bu-slideshow-slidelist ul li:last-child .bu-slide-edit-container").slideDown()):f(buSlideshowLocalAdmin.addSlideFailError,b("#bu-slideshow-slidelist"))})},r=function(a){p=a.attr("href")+ "&width=640&height="+n;a.attr("href",p)};b(".bu-slide-edit-container").hide();b(".bu-slide-expand").live("click",function(){var a=b(this),c;c=a.parents(".bu-slideshow-slide").find(".bu-slide-edit-container");a.hasClass("open")?(a.removeClass("open"),c.slideUp(300)):(a.addClass("open"),c.slideDown(300));return!1});b(".bu-slideshow-title-input").live("keyup",function(){var a=b(this);a.parents(".bu-slideshow-slide").find(".bu-slide-title").text(a.val())});b("#bu-slideshow-editform").live("submit",function(){return b("#bu_slideshow_name").val().replace(" ", "")?!window.reindexingSlides:(f(buSlideshowLocalAdmin.emptyNameError,b(this)),!1)});b("#bu-slideshow-slidelist ul").sortable({stop:q,placeholder:"sortable-placeholder",start:function(a,c){var e=c.item.height(),d=c.item.width();b(".sortable-placeholder").outerHeight(e).width(d)}});b("#bu-slideshow-add-slide").click(function(){var a=l.find("#bu-slideshow-slidelist li").length;t(a);return!1});b(".bu-slide-delete-button").live("click",function(){confirm(buSlideshowLocalAdmin.deleteConfirmSlide)&&(b(this).parents().parent(".bu-slideshow-slide").remove(), q());return!1});window.buUploaders={newEditor:window.wp&&window.wp.media?!0:!1,init:function(a){a=b(a);if(!a.length)throw new TypeError("No valid button identified.");this.slide=a.parents(".bu-slideshow-slide");this.populateFields()},populateFields:function(){this.addButton=this.slide.find(".bu-slideshow-add-img");this.removeButton=this.slide.find(".bu-slideshow-remove-img");this.imgIdField=this.slide.find(".bu-slideshow-img-id");this.imgSizeField=this.slide.find(".bu-slideshow-img-size");this.thumbContainers= this.slide.find(".bu-slide-thumb, .bu-slide-header-thumb")},select:function(){if(this.newEditor)return!1;this.oldHandleImageSelect()},remove:function(){this.thumbContainers.each(function(a,c){b(c).find("img").remove()});this.imgIdField.val("");this.imgSizeField.val("");this.removeButton.hide()},oldHandleImageSelect:function(){var a=this;window.send_to_editor=function(c){var e,d;b("body").append("<div id='slideshow_image_added' style='display:none;'>"+c+"</div>");e=b("#slideshow_image_added").find("img").attr("class"); d=/wp-image-([0-9]*)/i;(d=d.exec(e))?(c=d[1],d=/size-([a-zA-Z]*)/i,d=d.exec(e),e=d[1],d?(a.setImageDetails(c,e),c={action:"bu_get_slide_thumb",image_id:c},b.post(ajaxurl,c,function(b){a.handleImgThumbResponse(b)}),b("#slideshow_image_added").remove(),tb_remove()):(tb_remove(),f(buSlideshowLocalAdmin.imageFail,a.slide.find(".bu-slide-edit-container"),!0))):(tb_remove(),f(buSlideshowLocalAdmin.imageFail,a.slide.find(".bu-slide-edit-container"),!0))}},handleImgThumbResponse:function(a){var c,e;(a=b.parseJSON(a))&& "0"!==a?(this.thumbContainers.each(function(d,f){e=b(f);c=e.find("img");c.length?c.attr("src",a[0]):e.append('<img src="'+a[0]+'" alt="'+buSlideshowLocalAdmin.thumbAltText+'" />')}),this.removeButton.show()):f(buSlideshowLocalAdmin.thumbFailError,this.slide.find(".bu-slide-edit-container"),!0)},setImageDetails:function(a,b){this.imgIdField.val(a);this.imgSizeField.val(b)}};b(".bu-slideshow-add-img").live("click",function(a){a.preventDefault();window.buUploaders.init(this);window.buUploaders.select(); return!1});b(".bu-slideshow-remove-img").live("click",function(){window.buUploaders.init(this);window.buUploaders.remove();return!1});b("#bu-slideshow-slidelist .bu-slideshow-add-img").each(function(){r(b(this))})}});