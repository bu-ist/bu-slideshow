jQuery(document).ready(function(b){function e(a,d,f){"undefined"===typeof f&&(f=!1);b(".error").remove();a='<div class="error"><p>'+a+"</p></div>";f?d.prepend(a):d.append(a);setTimeout(function(){b(".error").fadeOut(500)},1E3)}var j=b("#bu-slideshow-newform"),s=b("#bu-slideshow-manage"),k=b("#bu-slideshow-slides"),l=b("#bu-slideshow-edit");j.length&&j.submit(function(){return!b("#bu-new-slideshow-name").val().length?(e("You must enter a name.",j),!1):!0});if(s.length&&k.length){var c={};c.container= k;c.list=b("#bu-slideshow-manage");if(!c.list.length)throw TypeError("Invalid element supplied to slideshow manager.");c.nonce=b("#bu_slideshow_nonce").val();c.numShows=function(){return c.list.find("li").length};c.addEmptyMsg=function(){c.getUrl("add_url",function(a){c.list.append("<li><p>"+buSlideshowLocalAdmin.noSlideshowsMsg+'</p><p><a class="button" href="'+a+'">'+buSlideshowLocalAdmin.addButtonText+"</a></p></li>")})};c.getUrl=function(a,d){b.post(ajaxurl,{action:"bu_slideshow_get_url",url:a}, function(a){d(a)})};c.list.find(".bu-slideshow-delete").live("click",function(){if(confirm(buSlideshowLocalAdmin.deleteConfirm)){var a=b(this),d;d={action:"bu_delete_slideshow",id:a.attr("data-slideshow-id"),bu_slideshow_nonce:c.nonce};b.post(ajaxurl,d,function(b){c.deleteResponse(a,b)})}return!1});c.deleteResponse=function(a,b){if(b&&"0"!==b)a.parent().parent("li").remove(),c.container.find(".error").remove(),c.numShows()||c.addEmptyMsg();else return e(buSlideshowLocalAdmin.deleteError,c.container), !1}}if(b("#bu_slideshow_modal_button").length&&"function"===typeof BuModal&&"function"===typeof SlideshowSelector){var m=new BuModal({el:"#bu_slideshow_modal_wrap"}),h=new SlideshowSelector("#bu_slideshow_modal_wrap .bu-slideshow-selector");b("#bu_slideshow_modal_button").click(function(){m.open()});b("#bu_insert_slideshow").live("click",function(){var a;h.ui.parent().find(".error").remove();a=h.getOptions();if(!parseInt(a.show_id))return e(buSlideshowLocalAdmin.noneSelectedError,h.ui.parent()),!1; window.send_to_editor("<br />"+('[bu_slideshow show_id="'+a.show_id+'" show_nav="'+a.show_nav+'" transition="'+a.transition+'" nav_style="'+a.nav_style+'" autoplay="'+a.autoplay+'" width="'+a.width+'"]')+"<br />");h.reset();m.close();return!1})}if(l.length){var n,p;n=0.9*b(window).height();var q=function(){b("#bu-slideshow-editform-submit").attr("disabled","disabled");window.reindexingSlides=!0;var a=/bu_slides\[([0-9]*)\](.*)/,d="";b(".bu-slideshow-slide").each(function(f,c){b(c).find("input, textarea").each(function(c, e){var g=b(e);d=g.attr("name");d=d.replace(a,"bu_slides["+f+"]$2");g.attr("name",d)})});b("#bu-slideshow-editform-submit").removeAttr("disabled");window.reindexingSlides=!1},r=function(a){p=a.attr("href")+"&width=640&height="+n;a.attr("href",p)};b(".bu-slide-edit-container").hide();b(".bu-slide-expand").live("click",function(){var a=b(this),d;d=a.parents(".bu-slideshow-slide").find(".bu-slide-edit-container");a.hasClass("open")?(a.removeClass("open"),d.slideUp(300)):(a.addClass("open"),d.slideDown(300)); return!1});b(".bu-slideshow-title-input").live("keyup",function(){var a=b(this);a.parents(".bu-slideshow-slide").find(".bu-slide-title").text(a.val())});b("#bu-slideshow-editform").live("submit",function(){return!b("#bu_slideshow_name").val().replace(" ","")?(e(buSlideshowLocalAdmin.emptyNameError,b(this)),!1):!window.reindexingSlides});b("#bu-slideshow-slidelist ul").sortable({stop:q,placeholder:"sortable-placeholder",start:function(a,d){var c=d.item.height(),g=d.item.width();b(".sortable-placeholder").outerHeight(c).width(g)}}); b("#bu-slideshow-add-slide").click(function(){var a={action:"bu_add_slide",order:l.find("#bu-slideshow-slidelist li").length};b.post(ajaxurl,a,function(a){a?(a=b(a),a.find(".bu-slide-edit-container").css("display","none"),a.appendTo("#bu-slideshow-slidelist ul"),r(a.find(".bu-slideshow-add-img"))):e(buSlideshowLocalAdmin.addSlideFailError,b("#bu-slideshow-slidelist"))});return!1});b(".bu-slide-delete-button").live("click",function(){b(this).parents().parent(".bu-slideshow-slide").remove();q();return!1}); window.buUploaders={newEditor:window.wp&&window.wp.media?!0:!1,init:function(a){a=b(a);if(!a.length)throw new TypeError("No valid button identified.");this.slide=a.parents(".bu-slideshow-slide");this.populateFields()},populateFields:function(){this.addButton=this.slide.find(".bu-slideshow-add-img");this.removeButton=this.slide.find(".bu-slideshow-remove-img");this.imgIdField=this.slide.find(".bu-slideshow-img-id");this.imgSizeField=this.slide.find(".bu-slideshow-img-size");this.thumbContainers=this.slide.find(".bu-slide-thumb, .bu-slide-header-thumb")}, select:function(){if(this.newEditor)return!1;this.oldHandleImageSelect()},remove:function(){this.thumbContainers.each(function(a,d){b(d).find("img").remove()});this.imgIdField.val("");this.imgSizeField.val("");this.removeButton.hide()},oldHandleImageSelect:function(){var a=this;window.send_to_editor=function(d){var c,g;d=b("img",d).attr("class");c=/wp-image-([0-9]*)/i;c=c.exec(d);g=c[1];c=/size-([a-zA-Z]*)/i;c=c.exec(d);a.setImageDetails(g,c[1]);b.post(ajaxurl,{action:"bu_get_slide_thumb",image_id:g}, function(b){a.handleImgThumbResponse(b)});tb_remove()}},handleImgThumbResponse:function(a){var c,f;a=b.parseJSON(a);!a||"0"===a?e(buSlideshowLocalAdmin.thumbFailError,this.slide.find(".bu-slide-edit-container"),!0):(this.thumbContainers.each(function(g,e){f=b(e);c=f.find("img");c.length?c.attr("src",a[0]):f.append('<img src="'+a[0]+'" alt="'+buSlideshowLocalAdmin.thumbAltText+'" />')}),this.removeButton.show())},setImageDetails:function(a,b){this.imgIdField.val(a);this.imgSizeField.val(b)}};b(".bu-slideshow-add-img").live("click", function(a){a.preventDefault();window.buUploaders.init(this);window.buUploaders.select();return!1});b(".bu-slideshow-remove-img").live("click",function(){window.buUploaders.init(this);window.buUploaders.remove();return!1});b("#bu-slideshow-slidelist .bu-slideshow-add-img").each(function(){r(b(this))})}});