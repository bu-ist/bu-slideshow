(function(a){function m(d,e){a("#bu-slideshow-editform-submit").prop("disabled","disabled");window.reindexingSlides=!0;var f=/bu_slides\[([0-9]*)\](.*)/,g="";a(".bu-slideshow-slide").each(function(d,e){a(e).find("input, textarea, select").each(function(c,b){var p=a(b);g=p.attr("name");g=g.replace(f,"bu_slides["+d+"]$2");p.attr("name",g)})});a("#bu-slideshow-editform-submit").prop("disabled",!1);window.reindexingSlides=!1}function r(d,e){var f=e.item.height(),g=e.item.width();a(".sortable-placeholder").outerHeight(f).width(g)}
function t(d){a.post(ajaxurl,{action:"bu_add_slide",order:d},function(d){d?(d=a(d),d.appendTo("#bu-slideshow-slidelist ul"),q(d.find(".bu-slideshow-add-img")),a("#bu-slideshow-slidelist ul li:last-child .bu-slide-edit-container").slideDown()):h(buSlideshowLocalAdmin.addSlideFailError,a("#bu-slideshow-slidelist"))})}function q(d){imgHref=d.attr("href")+"&width=640&height="+.9*a(window).height();d.attr("href",imgHref)}function h(d,e,f){"undefined"===typeof f&&(f=!1);a(".error").remove();d='<div class="error"><p>'+
d+"</p></div>";f?e.prepend(d):e.append(d);setTimeout(function(){a(".error").fadeOut(500)},1E3)}a(function(){var d=a("#bu-slideshow-newform"),e=a("#bu-slideshow-manage"),f=a("#bu-slideshow-slides"),g=a("#bu-slideshow-edit");if(d.length)d.on("submit",function(){return a("#bu-new-slideshow-name").val().length?!0:(h("You must enter a name.",d),!1)});e.length&&f.length&&function(c){var b={};b.container=f;b.list=a(c.list);if(!b.list.length)throw TypeError("Invalid element supplied to slideshow manager.");
b.nonce=a("#bu_slideshow_nonce").val();b.numShows=function(){return b.list.find("li").length};b.addEmptyMsg=function(){b.getUrl("add_url",function(a){b.list.append("<li><p>"+buSlideshowLocalAdmin.noSlideshowsMsg+'</p><p><a class="button" href="'+a+'">'+buSlideshowLocalAdmin.addButtonText+"</a></p></li>")})};b.getUrl=function(c,b){a.post(ajaxurl,{action:"bu_slideshow_get_url",url:c},function(a){b(a)})};b.list.on("click",".bu-slideshow-delete",function(){if(confirm(buSlideshowLocalAdmin.deleteConfirm)){var c=
a(this);var d={action:"bu_delete_slideshow",id:c.attr("data-slideshow-id"),bu_slideshow_nonce:b.nonce};a.post(ajaxurl,d,function(a){b.deleteResponse(c,a)})}return!1});b.deleteResponse=function(a,c){if(c&&"0"!==c)a.parent().parent("li").remove(),b.container.find(".error").remove(),b.numShows()||b.addEmptyMsg();else return h(buSlideshowLocalAdmin.deleteError,b.container),!1}}({list:"#bu-slideshow-manage"});if(a("#bu_slideshow_modal_button").length&&"function"===typeof BuModal&&"function"===typeof SlideshowSelector){var n=
new BuModal({el:"#bu_slideshow_modal_wrap",height:"80%"}),k=new SlideshowSelector("#bu_slideshow_modal_wrap .bu-slideshow-selector");a("#bu_slideshow_modal_button").on("click",function(){n.open()});a("#bu_slideshow_modal_wrap").on("click","#bu_insert_slideshow",function(a){k.ui.parent().find(".error").remove();a=k.getOptions();if(!parseInt(a.show_id))return h(buSlideshowLocalAdmin.noneSelectedError,k.ui.parent()),!1;window.send_to_editor("<br />"+('[bu_slideshow show_id="'+a.show_id+'" show_nav="'+
a.show_nav+'" transition="'+a.transition+'" nav_style="'+a.nav_style+'" autoplay="'+a.autoplay+'" transition_delay="'+a.transition_delay+'" width="'+a.width+'" shuffle="'+a.shuffle+'"]')+"<br />");k.reset();n.close();return!1})}a("#bu_slideshow_modal_wrap").on("click","#bu_insert_slideshow",function(c){new SlideshowSelector("#bu_slideshow_modal_wrap .bu-slideshow-selector");c=jQuery(".bu-slideshow-selector option:selected").val();var b=jQuery("#bu_slideshow_custom_trans").val();b=""==b?jQuery("#bu_slideshow_select_transition option:selected").val():
b;var d=jQuery("#bu_slideshow_transition_delay").val(),e=a("input[name='bu_slideshow_show_nav']:checked").val();"1"!=e&&(e="0");var f=jQuery("#bu_slideshow_width").val(),g=jQuery("#bu_slideshow_nav_style option:selected").val(),h=a("input[name='bu_slideshow_shuffle']:checked").val();h="true"!=h?"0":"1";var k=a("input[name='bu_slideshow_autoplay']:checked").val();var l="<p>Copy and paste the following snippet into a Shortcode block</p>[bu_slideshow show_id='"+c+"' show_nav='"+e+"' nav_style='"+g+"' transition='"+
b+"' transition_delay='"+d+"' shuffle='"+h+"'  width='"+f+"' align='";jQuery(".bu_slideshow_alignment_loop").each(function(a,b,c){if(jQuery(b).prop("checked"))return l+=jQuery(b).prop("id").substring(23,100),!1});l=l+"' autoplay='"+k+"']";jQuery(".slide-show-generated-shortcode").html(l);return!0});g.length&&(a(".bu-slideshow-slide:first-child").addClass("open"),a("#bu-slideshow-slidelist").on("click",".bu-slide-expand",function(){var c=a(this).parents(".bu-slideshow-slide").first(),b=c.find(".bu-slide-edit-container");
c.hasClass("open")?(c.removeClass("open"),b.slideUp(300)):(c.addClass("open"),b.slideDown(300));return!1}),a("#bu-slideshow-slidelist").on("keyup",".bu-slideshow-title-input",function(){var c=a(this);c.parents(".bu-slideshow-slide").find(".bu-slide-title").text(c.val())}),a("#bu-slideshow-editform").on("submit",function(){return a("#bu_slideshow_name").val().replace(" ","")?!window.reindexingSlides:(h(buSlideshowLocalAdmin.emptyNameError,a(this)),!1)}),a("#bu-slideshow-slidelist ul").sortable({stop:m,
placeholder:"sortable-placeholder",start:r}),a("#bu-slideshow-add-slide").on("click",function(){var a=g.find("#bu-slideshow-slidelist li").length;t(a);return!1}),a("#bu-slideshow-slidelist").on("click",".bu-slide-delete-button",function(){confirm(buSlideshowLocalAdmin.deleteConfirmSlide)&&(a(this).parents().parent(".bu-slideshow-slide").remove(),m());return!1}),window.buUploaders={init:function(c){c=a(c);if(!c.length)throw new TypeError("No valid button identified.");this.slide=c.parents(".bu-slideshow-slide");
this.populateFields()},populateFields:function(){this.addButton=this.slide.find(".bu-slideshow-add-img");this.removeButton=this.slide.find(".bu-slideshow-remove-img");this.imgIdField=this.slide.find(".bu-slideshow-img-id");this.imgSizeField=this.slide.find(".bu-slideshow-img-size");this.imgMeta=this.slide.find(".bu-slide-meta");this.thumbContainers=this.slide.find(".bu-slide-thumb, .bu-slide-header-thumb")},select:function(){this.newHandleImageSelect()},remove:function(){this.thumbContainers.each(function(c,
b){a(b).find("img").remove()});this.imgIdField.val("");this.imgSizeField.val("");this.imgMeta.hide();this.removeButton.hide()},handleImgThumbResponse:function(c){var b,d;c&&"0"!==c?(this.thumbContainers.each(function(e,f){d=a(f);b=d.find("img");b.length?b.replaceWith(c):d.append(c)}),this.removeButton.show()):h(buSlideshowLocalAdmin.thumbFailError,this.slide.find(".bu-slide-edit-container"),!0)},newHandleImageSelect:function(){var a=this;"object"!==typeof buUploadFrame&&(a.modifyWPSelectFrame(),buUploadFrame=
wp.media.frames.bu_slideshow_frame=wp.media({frame:"select",state:"bu-slideshow-image",states:[new wp.media.controller.BuSlideshowImage],button:{text:buSlideshowLocalAdmin.mediaUploadButton},library:{type:"image"}}),buUploadFrame.state("bu-slideshow-image").on("select",function(){var b=this.get("selection").first();var c=this.display(b).attributes;b=b.toJSON().id;a.getImgThumb(b);a.setImageDetails(b,c.size);a.slide.find(".bu-slide-meta").hide()}));buUploadFrame.open()},modifyWPSelectFrame:function(){wp.media.controller.BuSlideshowImage=
wp.media.controller.Library.extend({defaults:_.defaults({id:"bu-slideshow-image",library:wp.media.query({type:"image"}),multiple:!1,priority:60,displaySettings:!0,displayUserSettings:!0,title:buSlideshowLocalAdmin.mediaUploadTitle},wp.media.controller.Library.prototype.defaults)})},getImgThumb:function(c){var b=this;a.post(ajaxurl,{action:"bu_get_slide_thumb",image_id:c},function(a){b.handleImgThumbResponse(a)})},setImageDetails:function(a,b){this.imgIdField.val(a);this.imgSizeField.val(b)}},a("#bu-slideshow-slidelist").on("click",
".bu-slideshow-add-img",function(a){window.buUploaders.init(this);window.buUploaders.select();return!1}),a("#bu-slideshow-slidelist").on("click",".bu-slideshow-remove-img",function(){window.buUploaders.init(this);window.buUploaders.remove();return!1}),a("#bu-slideshow-slidelist .bu-slideshow-add-img").each(function(){q(a(this))}));a("#bu_slideshow_show_nav").on("click",function(){a(".bu_slideshow_nav_style").toggle()})})})(jQuery);