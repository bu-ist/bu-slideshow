!function(h){function d(e,i){h("#bu-slideshow-editform-submit").prop("disabled","disabled"),window.reindexingSlides=!0;var l=/bu_slides\[([0-9]*)\](.*)/,o="";h(".bu-slideshow-slide").each(function(t,e){h(e).find("input, textarea, select").each(function(e,i){var s=h(i);o=(o=s.attr("name")).replace(l,"bu_slides["+t+"]$2"),s.attr("name",o)})}),h("#bu-slideshow-editform-submit").prop("disabled",!1),window.reindexingSlides=!1}function n(e,i){var s=i.item.height(),t=i.item.width();h(".sortable-placeholder").outerHeight(s).width(t)}function a(e){imgHref=e.attr("href")+"&width=640&height="+.9*h(window).height(),e.attr("href",imgHref)}function r(e,i,s){void 0===s&&(s=!1),h(".error").remove();var t='<div class="error"><p>'+e+"</p></div>";s?i.prepend(t):i.append(t),setTimeout(function(){h(".error").fadeOut(500)},1e3)}h(function(){var e=h("#bu-slideshow-newform"),i=h("#bu-slideshow-manage"),t=h("#bu-slideshow-slides"),s=h("#bu-slideshow-edit");if(e.length&&e.on("submit",function(){return!!h("#bu-new-slideshow-name").val().length||(r("You must enter a name.",e),!1)}),i.length&&t.length){!function(e){var s={};if(s.container=t,s.list=h(e.list),!s.list.length)throw TypeError("Invalid element supplied to slideshow manager.");s.nonce=h("#bu_slideshow_nonce").val(),s.numShows=function(){return s.list.find("li").length},s.addEmptyMsg=function(){s.getUrl("add_url",function(e){var i="<li><p>"+buSlideshowLocalAdmin.noSlideshowsMsg+'</p><p><a class="button" href="'+e+'">'+buSlideshowLocalAdmin.addButtonText+"</a></p></li>";s.list.append(i)})},s.getUrl=function(e,i){var s={action:"bu_slideshow_get_url",url:e};h.post(ajaxurl,s,function(e){i(e)})},s.list.on("click",".bu-slideshow-delete",function(){if(confirm(buSlideshowLocalAdmin.deleteConfirm)){var e,i=h(this);e={action:"bu_delete_slideshow",id:i.attr("data-slideshow-id"),bu_slideshow_nonce:s.nonce},h.post(ajaxurl,e,function(e){s.deleteResponse(i,e)})}return!1}),s.deleteResponse=function(e,i){if(!i||"0"===i)return r(buSlideshowLocalAdmin.deleteError,s.container),!1;e.parent().parent("li").remove(),s.container.find(".error").remove(),s.numShows()||s.addEmptyMsg()}}({list:"#bu-slideshow-manage"})}if(h("#bu_slideshow_modal_button").length&&"function"==typeof BuModal&&"function"==typeof SlideshowSelector){var l=new BuModal({el:"#bu_slideshow_modal_wrap",height:"80%"}),o=new SlideshowSelector("#bu_slideshow_modal_wrap .bu-slideshow-selector");h("#bu_slideshow_modal_button").on("click",function(){l.open()}),h("#bu_slideshow_modal_wrap").on("click","#bu_insert_slideshow",function(e){var i,s;return o.ui.parent().find(".error").remove(),i=o.getOptions(),parseInt(i.show_id)?(s='[bu_slideshow show_id="'+i.show_id+'" show_nav="'+i.show_nav+'" transition="'+i.transition+'" nav_style="'+i.nav_style+'" autoplay="'+i.autoplay+'" transition_delay="'+i.transition_delay+'" width="'+i.width+'" shuffle="'+i.shuffle+'"]',window.send_to_editor("<br />"+s+"<br />"),o.reset(),l.close()):r(buSlideshowLocalAdmin.noneSelectedError,o.ui.parent()),!1})}else h("#bu_slideshow_moddal_wrap").on("click","#bu_insert_slideshow",function(e){new SlideshowSelector("#bu_slideshow_modal_wrap .bu-slideshow-selector");var t,i=jQuery(".bu-slideshow-selector option:selected").val(),s=jQuery("#bu_slideshow_custom_trans").val();if(""==s)var l=jQuery("#bu_slideshow_select_transition option:selected").val();else l=s;var o=jQuery("#bu_slideshow_transition_delay").val();if("1"!=(d=h("input[name='bu_slideshow_show_nav']:checked").val()))var d="0";var n=jQuery("#bu_slideshow_width").val(),a=jQuery("#bu_slideshow_nav_style option:selected").val();if("true"!=(r=h("input[name='bu_slideshow_shuffle']:checked").val()))var r="0";else r="1";var u=h("input[name='bu_slideshow_autoplay']:checked").val();return t="<p>Copy and paste the following snippet into a Shortcode block</p>[bu_slideshow show_id='"+i+"' show_nav='"+d+"' nav_style='"+a+"' transition='"+l+"' transition_delay='"+o+"' shuffle='"+r+"'  width='"+n+"' align='",jQuery(".bu_slideshow_alignment_loop").each(function(e,i,s){if(jQuery(i).prop("checked"))return t+=jQuery(i).prop("id").substring(23,100),!1}),t=t+"' autoplay='"+u+"']",jQuery(".slide-show-generated-shortcode").html(t),!0});s.length&&(h(".bu-slideshow-slide:first-child").addClass("open"),h("#bu-slideshow-slidelist").on("click",".bu-slide-expand",function(){var e=h(this).parents(".bu-slideshow-slide").first(),i=e.find(".bu-slide-edit-container");return e.hasClass("open")?(e.removeClass("open"),i.slideUp(300)):(e.addClass("open"),i.slideDown(300)),!1}),h("#bu-slideshow-slidelist").on("keyup",".bu-slideshow-title-input",function(){var e=h(this);e.parents(".bu-slideshow-slide").find(".bu-slide-title").text(e.val())}),h("#bu-slideshow-editform").on("submit",function(){return h("#bu_slideshow_name").val().replace(" ","")?!window.reindexingSlides:(r(buSlideshowLocalAdmin.emptyNameError,h(this)),!1)}),h("#bu-slideshow-slidelist ul").sortable({stop:d,placeholder:"sortable-placeholder",start:n}),h("#bu-slideshow-add-slide").on("click",function(){return function(e){var i={action:"bu_add_slide",order:e};h.post(ajaxurl,i,function(e){if(e){var i=h(e);i.appendTo("#bu-slideshow-slidelist ul"),a(i.find(".bu-slideshow-add-img")),h("#bu-slideshow-slidelist ul li:last-child .bu-slide-edit-container").slideDown()}else r(buSlideshowLocalAdmin.addSlideFailError,h("#bu-slideshow-slidelist"))})}(s.find("#bu-slideshow-slidelist li").length),!1}),h("#bu-slideshow-slidelist").on("click",".bu-slide-delete-button",function(){return confirm(buSlideshowLocalAdmin.deleteConfirmSlide)&&(h(this).parents().parent(".bu-slideshow-slide").remove(),d()),!1}),window.buUploaders={init:function(e){var i=h(e);if(!i.length)throw new TypeError("No valid button identified.");this.slide=i.parents(".bu-slideshow-slide"),this.populateFields()},populateFields:function(){this.addButton=this.slide.find(".bu-slideshow-add-img"),this.removeButton=this.slide.find(".bu-slideshow-remove-img"),this.imgIdField=this.slide.find(".bu-slideshow-img-id"),this.imgSizeField=this.slide.find(".bu-slideshow-img-size"),this.imgMeta=this.slide.find(".bu-slide-meta"),this.thumbContainers=this.slide.find(".bu-slide-thumb, .bu-slide-header-thumb")},select:function(){this.newHandleImageSelect()},remove:function(){this.thumbContainers.each(function(e,i){h(i).find("img").remove()}),this.imgIdField.val(""),this.imgSizeField.val(""),this.imgMeta.hide(),this.removeButton.hide()},handleImgThumbResponse:function(s){var t,l;s&&"0"!==s?(this.thumbContainers.each(function(e,i){l=h(i),(t=l.find("img")).length?t.replaceWith(s):l.append(s)}),this.removeButton.show()):r(buSlideshowLocalAdmin.thumbFailError,this.slide.find(".bu-slide-edit-container"),!0)},newHandleImageSelect:function(){var t=this;"object"!=typeof buUploadFrame&&(t.modifyWPSelectFrame(),buUploadFrame=wp.media.frames.bu_slideshow_frame=wp.media({frame:"select",state:"bu-slideshow-image",states:[new wp.media.controller.BuSlideshowImage],button:{text:buSlideshowLocalAdmin.mediaUploadButton},library:{type:"image"}}),buUploadFrame.state("bu-slideshow-image").on("select",function(){var e,i,s;e=this.get("selection").first(),i=this.display(e).attributes,s=e.toJSON().id,t.getImgThumb(s),t.setImageDetails(s,i.size),t.slide.find(".bu-slide-meta").hide()})),buUploadFrame.open()},modifyWPSelectFrame:function(){wp.media.controller.BuSlideshowImage=wp.media.controller.Library.extend({defaults:_.defaults({id:"bu-slideshow-image",library:wp.media.query({type:"image"}),multiple:!1,priority:60,displaySettings:!0,displayUserSettings:!0,title:buSlideshowLocalAdmin.mediaUploadTitle},wp.media.controller.Library.prototype.defaults)})},getImgThumb:function(e){var i,s=this;i={action:"bu_get_slide_thumb",image_id:e},h.post(ajaxurl,i,function(e){s.handleImgThumbResponse(e)})},setImageDetails:function(e,i){this.imgIdField.val(e),this.imgSizeField.val(i)}},h("#bu-slideshow-slidelist").on("click",".bu-slideshow-add-img",function(e){return window.buUploaders.init(this),window.buUploaders.select(),!1}),h("#bu-slideshow-slidelist").on("click",".bu-slideshow-remove-img",function(){return window.buUploaders.init(this),window.buUploaders.remove(),!1}),h("#bu-slideshow-slidelist .bu-slideshow-add-img").each(function(){a(h(this))})),h("#bu_slideshow_show_nav").on("click",function(){h(".bu_slideshow_nav_style").toggle()})})}(jQuery);